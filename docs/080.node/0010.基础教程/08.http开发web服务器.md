---
title: httpå¼€å‘webæœåŠ¡å™¨
date: 2023-03-29 20:35:50
permalink: /pages/e69a90/
categories:
  - node
tags:
  - 
---
> ä»€ä¹ˆæ˜¯WebæœåŠ¡å™¨ï¼Ÿ
>
> å½“åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰éœ€è¦æŸä¸€ä¸ªèµ„æºæ—¶ï¼Œå¯ä»¥å‘ä¸€ä¸ªå°æœåŠ¡å™¨ï¼Œé€šè¿‡Httpè¯·æ±‚è·å–åˆ°è¿™ä¸ªèµ„æºï¼›æä¾›æœåŠ¡å™¨çš„è¿™ä¸ªæœåŠ¡å™¨ï¼Œå°±æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨ï¼›

![å›¾ç‰‡](./assets/640-1642169270017.jpeg)

ç›®å‰æœ‰å¾ˆå¤šå¼€æºçš„WebæœåŠ¡å™¨ï¼šNginxã€Apacheï¼ˆé™æ€ï¼‰ã€Apache Tomcatï¼ˆé™æ€ã€åŠ¨æ€ï¼‰ã€Node.js

## ä¸€. Httpæ¨¡æ¿åŸºæœ¬ä½¿ç”¨

### 1.1. å¦‚ä½•åˆ›å»ºæœåŠ¡

#### 1.1.1. WebæœåŠ¡å™¨åˆä½“éªŒ

åˆ›å»ºä¸€ä¸ªWebæœåŠ¡å™¨çš„åˆä½“éªŒï¼š

```javascript
const http = require('http');

const HTTP_PORT = 8000;

const server = http.createServer((req, res) => {
  res.end("Hello World");
});

server.listen(8000, () => {
  console.log(`ğŸš€æœåŠ¡å™¨åœ¨${HTTP_PORT}å¯åŠ¨~`)
})
```

#### 1.1.2. åˆ›å»ºæœåŠ¡å™¨

åˆ›å»ºæœåŠ¡å™¨å¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ `createServer` æ¥å®Œæˆçš„

- `http.createServer`ä¼šè¿”å›æœåŠ¡å™¨çš„å¯¹è±¡ï¼›
- åº•å±‚å…¶å®ä½¿ç”¨ç›´æ¥ new Server å¯¹è±¡ã€‚

```javascript
function createServer(opts, requestListener) {
  return new Server(opts, requestListener);
}
```

é‚£ä¹ˆï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±æ¥åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼š

```javascript
const server2 = new http.Server((req, res) => {
  res.end("Hello Server2");
});

server2.listen(9000, () => {
  console.log("æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ~");
})
```

ä¸Šé¢æˆ‘ä»¬å·²ç»çœ‹åˆ°ï¼Œåˆ›å»ºServeræ—¶ä¼šä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ä¼šä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š

- reqï¼šrequestè¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«è¯·æ±‚ç›¸å…³çš„ä¿¡æ¯ï¼›
- resï¼šresponseå“åº”å¯¹è±¡ï¼ŒåŒ…å«æˆ‘ä»¬è¦å‘é€ç»™å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼›

#### 1.1.3. ç›‘å¬ç«¯å£å’Œä¸»æœº

**Server**é€šè¿‡listenæ–¹æ³•æ¥å¼€å¯æœåŠ¡å™¨ï¼Œå¹¶ä¸”åœ¨æŸä¸€ä¸ªä¸»æœºå’Œç«¯å£ä¸Šç›‘å¬ç½‘ç»œè¯·æ±‚ï¼š

- ä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬é€šè¿‡ `ip:port`çš„æ–¹å¼å‘é€åˆ°æˆ‘ä»¬ç›‘å¬çš„WebæœåŠ¡å™¨ä¸Šæ—¶ï¼›
- æˆ‘ä»¬å°±å¯ä»¥å¯¹å…¶è¿›è¡Œç›¸å…³çš„å¤„ç†ï¼›

`listen`å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°ï¼š

- ç«¯å£port: å¯ä»¥ä¸ä¼ , ç³»ç»Ÿä¼šé»˜è®¤åˆ†é…ç«¯, åç»­é¡¹ç›®ä¸­æˆ‘ä»¬ä¼šå†™å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼›

- ä¸»æœºhost: é€šå¸¸å¯ä»¥ä¼ å…¥localhostã€ipåœ°å€127.0.0.1ã€æˆ–è€…ipåœ°å€0.0.0.0ï¼Œé»˜è®¤æ˜¯0.0.0.0ï¼›

- - ç›‘å¬IPV4ä¸Šæ‰€æœ‰çš„åœ°å€ï¼Œå†æ ¹æ®ç«¯å£æ‰¾åˆ°ä¸åŒçš„åº”ç”¨ç¨‹åºï¼›
  - æ¯”å¦‚æˆ‘ä»¬ç›‘å¬ `0.0.0.0`æ—¶ï¼Œåœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹çš„ä¸»æœºä¸­ï¼Œé€šè¿‡ipåœ°å€æ˜¯å¯ä»¥è®¿é—®çš„ï¼›
  - æ­£å¸¸çš„æ•°æ®åº“åŒ…ç»å¸¸ åº”ç”¨å±‚ - ä¼ è¾“å±‚ - ç½‘ç»œå±‚ - æ•°æ®é“¾è·¯å±‚ - ç‰©ç†å±‚ ï¼›
  - è€Œå›ç¯åœ°å€ï¼Œæ˜¯åœ¨ç½‘ç»œå±‚ç›´æ¥å°±è¢«è·å–åˆ°äº†ï¼Œæ˜¯ä¸ä¼šç»å¸¸æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚çš„ï¼›
  - æ¯”å¦‚æˆ‘ä»¬ç›‘å¬ `127.0.0.1`æ—¶ï¼Œåœ¨åŒä¸€ä¸ªç½‘æ®µä¸‹çš„ä¸»æœºä¸­ï¼Œé€šè¿‡ipåœ°å€æ˜¯ä¸èƒ½è®¿é—®çš„ï¼›
  - localhostï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸŸåï¼Œé€šå¸¸æƒ…å†µä¸‹ä¼šè¢«è§£ææˆ127.0.0.1ï¼›
  - 127.0.0.1ï¼šå›ç¯åœ°å€ï¼ˆLoop Back Addressï¼‰ï¼Œè¡¨è¾¾çš„æ„æ€å…¶å®æ˜¯æˆ‘ä»¬ä¸»æœºè‡ªå·±å‘å‡ºå»çš„åŒ…ï¼Œç›´æ¥è¢«è‡ªå·±æ¥æ”¶ï¼›
  - 0.0.0.0ï¼š

- å›è°ƒå‡½æ•°ï¼šæœåŠ¡å™¨å¯åŠ¨æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°ï¼›

```javascript
server.listen(() => {
  console.log("æœåŠ¡å™¨å¯åŠ¨~ğŸš€");
})
```

### 1.2. requestè¯·æ±‚å¯¹è±¡

åœ¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šæºå¸¦å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š

- æœ¬æ¬¡è¯·æ±‚çš„URLï¼ŒæœåŠ¡å™¨éœ€è¦æ ¹æ®ä¸åŒçš„URLè¿›è¡Œä¸åŒçš„å¤„ç†ï¼›
- æœ¬æ¬¡è¯·æ±‚çš„è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚GETã€POSTè¯·æ±‚ä¼ å…¥çš„å‚æ•°å’Œå¤„ç†çš„æ–¹å¼æ˜¯ä¸åŒçš„ï¼›
- æœ¬æ¬¡è¯·æ±‚çš„headersä¸­ä¹Ÿä¼šæºå¸¦ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚å®¢æˆ·ç«¯ä¿¡æ¯ã€æ¥å—æ•°æ®çš„æ ¼å¼ã€æ”¯æŒçš„ç¼–ç æ ¼å¼ç­‰ï¼›
- ç­‰ç­‰...

è¿™äº›ä¿¡æ¯ï¼ŒNodeä¼šå¸®åŠ©æˆ‘ä»¬å°è£…åˆ°ä¸€ä¸ªrequestçš„å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ¥å¤„ç†è¿™ä¸ªrequestå¯¹è±¡ï¼š

```javascript
const server = http.createServer((req, res) => {
  // requestå¯¹è±¡
  console.log(req.url);
  console.log(req.method);
  console.log(req.headers);

  res.end("Hello World");
});
```

#### 1.2.1. URLçš„å¤„ç†

å®¢æˆ·ç«¯åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šè¯·æ±‚ä¸åŒçš„æ•°æ®ï¼Œé‚£ä¹ˆä¼šä¼ å…¥ä¸åŒçš„è¯·æ±‚åœ°å€ï¼š

- æ¯”å¦‚ `http://localhost:8000/login`ï¼›
- æ¯”å¦‚ `http://localhost:8000/products`;

æœåŠ¡å™¨ç«¯éœ€è¦æ ¹æ®ä¸åŒçš„è¯·æ±‚åœ°å€ï¼Œä½œå‡ºä¸åŒçš„å“åº”ï¼š

```javascript
const server = http.createServer((req, res) => {
  const url = req.url;
  console.log(url);

  if (url === '/login') {
    res.end("welcome Back~");
  } else if (url === '/products') {
    res.end("products");
  } else {
    res.end("error message");
  }
});
```

é‚£ä¹ˆå¦‚æœç”¨æˆ·å‘é€çš„åœ°å€ä¸­è¿˜æºå¸¦ä¸€äº›é¢å¤–çš„å‚æ•°å‘¢ï¼Ÿ

- `http://localhost:8000/login?name=why&password=123`;
- è¿™ä¸ªæ—¶å€™ï¼Œurlçš„å€¼æ˜¯ `/login?name=why&password=123`ï¼›

æˆ‘ä»¬å¦‚ä½•å¯¹å®ƒè¿›è¡Œè§£æå‘¢ï¼Ÿ

- ä½¿ç”¨å†…ç½®æ¨¡å—urlï¼›

```javascript
const url = require('url');

// è§£æè¯·æ±‚
const parseInfo = url.parse(req.url);
console.log(parseInfo);
```

è§£æç»“æœï¼š

```javascript
Url {
  protocol: null,
  slashes: null,
  auth: null,
  host: null,
  port: null,
  hostname: null,
  hash: null,
  search: '?name=why&password=123',
  query: 'name=why&password=123',
  pathname: '/login',
  path: '/login?name=why&password=123',
  href: '/login?name=why&password=123'
}
```

æˆ‘ä»¬ä¼šå‘ç° `pathname`å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚

ä½†æ˜¯ `query` ä¿¡æ¯å¦‚ä½•å¯ä»¥è·å–å‘¢ï¼Ÿ

- æ–¹å¼ä¸€ï¼šæˆªå–å­—ç¬¦ä¸²ï¼›
- æ–¹å¼äºŒï¼šä½¿ç”¨querystringå†…ç½®æ¨¡å—ï¼›

```javascript
const { pathname, query } = url.parse(req.url);
const queryObj = qs.parse(query);
console.log(queryObj.name);
console.log(queryObj.password);
```

#### 1.2.2. Methodçš„å¤„ç†

åœ¨Restfulè§„èŒƒï¼ˆè®¾è®¡é£æ ¼ï¼‰ä¸­ï¼Œæˆ‘ä»¬å¯¹äºæ•°æ®çš„å¢åˆ æ”¹æŸ¥åº”è¯¥é€šè¿‡ä¸åŒçš„è¯·æ±‚æ–¹å¼ï¼š

- GETï¼šæŸ¥è¯¢æ•°æ®ï¼›
- POSTï¼šæ–°å»ºæ•°æ®ï¼›
- PATCHï¼šæ›´æ–°æ•°æ®ï¼›
- DELETEï¼šåˆ é™¤æ•°æ®ï¼›

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­ä¸åŒçš„è¯·æ±‚æ–¹å¼è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚

æ¯”å¦‚åˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼š

- è¯·æ±‚æ¥å£ä¸º `/users`ï¼›
- è¯·æ±‚æ–¹å¼ä¸º `POST`è¯·æ±‚ï¼›
- æºå¸¦æ•°æ® `username`å’Œ`password`ï¼›

![å›¾ç‰‡](./assets/640-1642169381733.jpeg)

åœ¨æˆ‘ä»¬ç¨‹åºä¸­å¦‚ä½•è¿›è¡Œåˆ¤æ–­ä»¥åŠè·å–å¯¹åº”çš„æ•°æ®å‘¢ï¼Ÿ

- è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­æ¥å£æ˜¯ `/users`ï¼Œå¹¶ä¸”è¯·æ±‚æ–¹å¼æ˜¯POSTæ–¹æ³•å»è·å–ä¼ å…¥çš„æ•°æ®ï¼›
- è·å–è¿™ç§bodyæºå¸¦çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç›‘å¬reqçš„ `data`äº‹ä»¶æ¥è·å–ï¼›

```javascript
if (req.url.indexOf('/users') !== -1) {
  if (req.method === 'POST') {
  
    // å¯ä»¥è®¾ç½®ç¼–ç ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸‹æ–¹é€šè¿‡ data.toString() è·å–å­—ç¬¦ä¸²æ ¼å¼
    req.setEncoding('utf-8');

    req.on('data', (data) => {
      const {username, password} = JSON.parse(data);
      console.log(username, password);
    });

    res.end("create user success");
  } else {
    res.end("users list");
  }
} else {
  res.end("error message");
}
```

å°†JSONå­—ç¬¦ä¸²æ ¼å¼è½¬æˆå¯¹è±¡ç±»å‹ï¼Œé€šè¿‡`JSON.parse`æ–¹æ³•å³å¯ã€‚

#### 1.2.3. headerå±æ€§

åœ¨requestå¯¹è±¡çš„headerä¸­ä¹ŸåŒ…å«å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼š

```javascript
const server = http.createServer((req, res) => {
  console.log(req.headers);

  res.end("Hello Header");
});
```

æµè§ˆå™¨ä¼šé»˜è®¤ä¼ é€’è¿‡æ¥ä¸€äº›ä¿¡æ¯ï¼š

```javascript
{
  'content-type': 'application/json',
  'user-agent': 'PostmanRuntime/7.26.5',
  accept: '*/*',
  'postman-token': 'afe4b8fe-67e3-49cc-bd6f-f61c95c4367b',
  host: 'localhost:8000',
  'accept-encoding': 'gzip, deflate, br',
  connection: 'keep-alive',
  'content-length': '48'
}
```

`content-type`æ˜¯è¿™æ¬¡è¯·æ±‚æºå¸¦çš„æ•°æ®çš„ç±»å‹ï¼š

- `application/json`è¡¨ç¤ºæ˜¯ä¸€ä¸ªjsonç±»å‹ï¼›
- `text/plain`è¡¨ç¤ºæ˜¯æ–‡æœ¬ç±»å‹ï¼›
- `application/xml`è¡¨ç¤ºæ˜¯xmlç±»å‹ï¼›
- `multipart/form-data`è¡¨ç¤ºæ˜¯ä¸Šä¼ æ–‡ä»¶ï¼›

`content-length`ï¼š

- æ–‡ä»¶çš„å¤§å°å’Œé•¿åº¦

`keep-alive`ï¼š

- httpæ˜¯åŸºäºTCPåè®®çš„ï¼Œä½†æ˜¯é€šå¸¸åœ¨è¿›è¡Œä¸€æ¬¡è¯·æ±‚å’Œå“åº”ç»“æŸåä¼šç«‹åˆ»ä¸­æ–­ï¼›

- åœ¨http1.0ä¸­ï¼Œå¦‚æœæƒ³è¦ç»§ç»­ä¿æŒè¿æ¥ï¼š

- - æµè§ˆå™¨éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `connection: keep-alive`ï¼›
  - æœåŠ¡å™¨éœ€è¦åœ¨å“åº”å¤´ä¸­æ·»åŠ  `connection:keey-alive`ï¼›
  - å½“å®¢æˆ·ç«¯å†æ¬¡æ”¾è¯·æ±‚æ—¶ï¼Œå°±ä¼šä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ï¼Œç›´æ¥ä¸€æ–¹ä¸­æ–­è¿æ¥ï¼›

- åœ¨http1.1ä¸­ï¼Œæ‰€æœ‰è¿æ¥é»˜è®¤æ˜¯ `connection: keep-alive`çš„ï¼›

- - ä¸åŒçš„WebæœåŠ¡å™¨ä¼šæœ‰ä¸åŒçš„ä¿æŒ `keep-alive`çš„æ—¶é—´ï¼›
  - Nodeä¸­é»˜è®¤æ˜¯5sä¸­ï¼›

`accept-encoding`ï¼š

- å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ”¯æŒçš„æ–‡ä»¶å‹ç¼©æ ¼å¼ï¼Œæ¯”å¦‚jsæ–‡ä»¶å¯ä»¥ä½¿ç”¨gzipç¼–ç ï¼Œå¯¹åº” `.gz`æ–‡ä»¶ï¼›

`accept`ï¼š

- å‘ŠçŸ¥æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å¯æ¥å—æ–‡ä»¶çš„æ ¼å¼ç±»å‹ï¼›

`user-agent`ï¼š

- å®¢æˆ·ç«¯ç›¸å…³çš„ä¿¡æ¯ï¼›

### 1.3. å“åº”å¯¹è±¡response

#### 1.3.1. è¿”å›å“åº”ç»“æœ

å¦‚æœæˆ‘ä»¬å¸Œæœ›ç»™å®¢æˆ·ç«¯å“åº”çš„ç»“æœæ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼ï¼š

- Writeæ–¹æ³•ï¼šè¿™ç§æ–¹å¼æ˜¯ç›´æ¥å†™å‡ºæ•°æ®ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å…³é—­æµï¼›
- endæ–¹æ³•ï¼šè¿™ç§æ–¹å¼æ˜¯å†™å‡ºæœ€åçš„æ•°æ®ï¼Œå¹¶ä¸”å†™å‡ºåä¼šå…³é—­æµï¼›

```javascript
const http = require('http');

const server = http.createServer((req, res) => {

  // å“åº”æ•°æ®çš„æ–¹å¼æœ‰ä¸¤ä¸ª:
  res.write("Hello World");
  res.write("Hello Response");
  res.end("message end");
});

server.listen(8000, () => {
  console.log("æœåŠ¡å™¨å¯åŠ¨ğŸš€~")
});
```

å¦‚æœæˆ‘ä»¬æ²¡æœ‰è°ƒç”¨ `end`å’Œ`close`ï¼Œå®¢æˆ·ç«¯å°†ä¼šä¸€ç›´ç­‰å¾…ç»“æœï¼Œæ‰€ä»¥å®¢æˆ·ç«¯åœ¨å‘é€ç½‘ç»œè¯·æ±‚æ—¶ï¼Œéƒ½ä¼šè®¾ç½®è¶…æ—¶æ—¶é—´ã€‚

#### 1.3.2. è¿”å›çŠ¶æ€ç 

HttpçŠ¶æ€ç ï¼ˆHttp Status Codeï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºHttpå“åº”çŠ¶æ€çš„æ•°å­—ä»£ç ï¼š

- HttpçŠ¶æ€ç éå¸¸å¤šï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œç»™å®¢æˆ·ç«¯è¿”å›ä¸åŒçš„çŠ¶æ€ç ï¼›
- å¸¸è§çš„çŠ¶æ€ç æ˜¯ä¸‹é¢è¿™äº›ï¼ˆåç»­é¡¹ç›®ä¸­ï¼Œä¹Ÿä¼šç”¨åˆ°å…¶ä¸­çš„çŠ¶æ€ç ï¼‰ï¼›

![å›¾ç‰‡](./assets/640-1642169459343.jpeg)

è®¾ç½®çŠ¶æ€ç å¸¸è§çš„æœ‰ä¸¤ç§æ–¹å¼ï¼š

```javascript
res.statusCode = 400;
res.writeHead(200);
```

#### 1.3.3. å“åº”å¤´æ–‡ä»¶

è¿”å›å¤´éƒ¨ä¿¡æ¯ï¼Œä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š

- `res.setHeader`ï¼šä¸€æ¬¡å†™å…¥ä¸€ä¸ªå¤´éƒ¨ä¿¡æ¯ï¼›
- `res.writeHead`ï¼šåŒæ—¶å†™å…¥headerå’Œstatusï¼›

```javascript
res.setHeader("Content-Type", "application/json;charset=utf8");

res.writeHead(200, {
  "Content-Type": "application/json;charset=utf8"
})
```

Headerè®¾ç½® `Content-Type`æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ

- é»˜è®¤å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå®¢æˆ·ç«¯ä¼šæŒ‰ç…§è‡ªå·±é»˜è®¤çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼›

æ¯”å¦‚ï¼Œæˆ‘ä»¬è¿”å›çš„æ˜¯ä¸€æ®µHTMLï¼Œä½†æ˜¯æ²¡æœ‰æŒ‡å®šæ ¼å¼ï¼š

```javascript
res.end('<h2>Hello World</h2>')
```

ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŒ‡å®šäº†æ ¼å¼ï¼š

```javascript
res.setHeader("Content-Type", "text/html;charset=utf8");
res.end('<h2>Hello World</h2>')
```

![å›¾ç‰‡](./assets/640-1642169501424.jpeg)

å¦‚æœæˆ‘ä»¬å¸Œæœ›è¿”å›ä¸€æ®µJSONæ•°æ®ï¼Œåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

```javascript
res.writeHead(200, {
  "Content-Type": "application/json;charset=utf8"
})

const data = {
  name: "ç‹çº¢å…ƒ",
  age: 18,
  height: 1.88
};

res.end(JSON.stringify(data));
```

## äºŒ. Webå…¶ä»–è¡¥å……

### 2.1. æ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨

å¦‚æœæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯è¿›è¡Œä¿å­˜åº”è¯¥å¦‚ä½•æ“ä½œå‘¢ï¼Ÿ

```javascript
const server = http.createServer((req, res) => {
  if (req.url === '/upload') {
    if (req.method === 'POST') {
      const fileWriter = fs.createWriteStream('./foo.png');
      req.pipe(fileWriter);

      const fileSize = req.headers['content-length'];
      let curSize = 0;
      console.log(fileSize);

      req.on("data", (data) => {
        curSize += data.length;
        console.log(curSize);
        res.write(`æ–‡ä»¶ä¸Šä¼ è¿›åº¦: ${curSize/fileSize * 100}%\n`);
      });

      req.on('end', () => {
        res.end("æ–‡ä»¶ä¸Šä¼ å®Œæˆ~");
      })
    }
  } else {
    res.end("error message");
  }
});
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°æ–‡ä»¶ä¸Šä¼ æˆåŠŸäº†ï¼Œä½†æ˜¯æ–‡ä»¶å´æ‰“ä¸å¼€ï¼š

- è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å†™å…¥çš„æ•°æ®ï¼Œé‡Œé¢åŒ…å«ä¸€äº›ç‰¹æ®Šçš„ä¿¡æ¯ï¼›
- è¿™äº›ä¿¡æ¯æ‰“å¼€çš„è½¯ä»¶å¹¶ä¸èƒ½å¾ˆå¥½çš„è§£æï¼›

```javascript
const server = http.createServer((req, res) => {
  if (req.url === '/upload') {
    if (req.method === 'POST') {
      // å›¾ç‰‡æ–‡ä»¶å¿…é¡»è®¾ç½®ä¸ºäºŒè¿›åˆ¶çš„
      req.setEncoding('binary');

      // è·å–content-typeä¸­çš„boundaryçš„å€¼
      var boundary = req.headers['content-type'].split('; ')[1].replace('boundary=','');
      
      // è®°å½•å½“å‰æ•°æ®çš„ä¿¡æ¯
      const fileSize = req.headers['content-length'];
      let curSize = 0;
      let body = '';

      // ç›‘å¬å½“å‰çš„æ•°æ®
      req.on("data", (data) => {
        curSize += data.length;
        res.write(`æ–‡ä»¶ä¸Šä¼ è¿›åº¦: ${curSize/fileSize * 100}%\n`);
        body += data;
      });

      // æ•°æ®ç»“æ„
      req.on('end', () => {
        // åˆ‡å‰²æ•°æ®
        const payload = qs.parse(body, "\r\n", ":");
        // è·å–æœ€åçš„ç±»å‹(image/png)
        const fileType = payload["Content-Type"].substring(1);
        // è·å–è¦æˆªå–çš„é•¿åº¦
        const fileTypePosition = body.indexOf(fileType) + fileType.length;
        let binaryData = body.substring(fileTypePosition);
        binaryData = binaryData.replace(/^\s\s*/, '');

        // binaryData = binaryData.replaceAll('\r\n', '');
        const finalData = binaryData.substring(0, binaryData.indexOf('--'+boundary+'--'));

        fs.writeFile('./boo.png', finalData, 'binary', (err) => {
          console.log(err);
          res.end("æ–‡ä»¶ä¸Šä¼ å®Œæˆ~");
        })
      })
    }
  } else {
    res.end("error message");
  }
});
```

### 2.2. httpå‘é€ç½‘ç»œè¯·æ±‚

axiosåº“å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨Nodeä¸­ä½¿ç”¨ï¼š

- åœ¨æµè§ˆå™¨ä¸­ï¼Œaxiosä½¿ç”¨çš„æ˜¯å°è£…xhrï¼›
- åœ¨Nodeä¸­ï¼Œä½¿ç”¨çš„æ˜¯httpå†…ç½®æ¨¡å—ï¼›

æ‰€ä»¥httpæ¨¡å—æ˜¯å¯ä»¥åœ¨Nodeä¸­ç›´æ¥å‘é€ç½‘ç»œè¯·æ±‚çš„ã€‚

å‘é€getè¯·æ±‚ï¼š

```javascript
http.get("http://localhost:8000", (res) => {
  res.on('data', data => {
    console.log(data.toString());
    console.log(JSON.parse(data.toString()));
  })
});
```

å‘é€postè¯·æ±‚ï¼š

```javascript
const req = http.request({
  method: 'POST',
  hostname: "localhost",
  port: 8000
}, (res) => {
  res.on('data', data => {
    console.log(data.toString());
    console.log(JSON.parse(data.toString()));
  })
})

req.on('error', err => {
  console.log(err);
})

req.end();
```